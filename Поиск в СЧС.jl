using Printf # –ò–º–ø–æ—Ä—Ç –º–æ–¥—É–ª—è –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –≤—ã–≤–æ–¥–∞ (@printf)
using CSV # –ò–º–ø–æ—Ä—Ç –º–æ–¥—É–ª—è –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å CSV-—Ñ–∞–π–ª–∞–º–∏
using DataFrames # –ò–º–ø–æ—Ä—Ç –º–æ–¥—É–ª—è –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ç–∞–±–ª–∏—á–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ (DataFrame)
using Base.Threads # –ò–º–ø–æ—Ä—Ç –º–æ–¥—É–ª—è –¥–ª—è –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç–∏
using ProgressMeter # –ò–º–ø–æ—Ä—Ç –º–æ–¥—É–ª—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–∞
using Random # –ò–º–ø–æ—Ä—Ç –º–æ–¥—É–ª—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–ª—É—á–∞–π–Ω—ã—Ö —á–∏—Å–µ–ª

# –§—É–Ω–∫—Ü–∏—è: —Ä–∞–∑–±–∏–≤–∞–µ—Ç —Å—Ç—Ä–æ–∫–æ–≤–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —á–∏—Å–ª–∞ N –Ω–∞ m —á–∞—Å—Ç–µ–π, —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—è —Å–∏–º–≤–æ–ª—ã –∫–∞–∫ –º–æ–∂–Ω–æ —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–µ–µ
function split_number_str(N::String, m::Integer)
len = length(N) # –ü–æ–ª—É—á–∞–µ–º –¥–ª–∏–Ω—É —Å—Ç—Ä–æ–∫–∏ —á–∏—Å–ª–∞
base_len = div(len, m) # –ë–∞–∑–æ–≤–∞—è –¥–ª–∏–Ω–∞ –∫–∞–∂–¥–æ–π —á–∞—Å—Ç–∏ (—Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω–æ–µ –¥–µ–ª–µ–Ω–∏–µ)
remainder = len % m # –û—Å—Ç–∞—Ç–æ–∫ –æ—Ç –¥–µ–ª–µ–Ω–∏—è ‚Äî —Å–∫–æ–ª—å–∫–æ —á–∞—Å—Ç–µ–π –ø–æ–ª—É—á–∞—Ç +1 —Å–∏–º–≤–æ–ª
parts = String[] # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—É—Å—Ç–æ–≥–æ –º–∞—Å—Å–∏–≤–∞ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —á–∞—Å—Ç–µ–π
idx = 1 # –ò–Ω–¥–µ–∫—Å –Ω–∞—á–∞–ª–∞ —Ç–µ–∫—É—â–µ–π —á–∞—Å—Ç–∏ –≤ —Å—Ç—Ä–æ–∫–µ
for i in 1:m # –¶–∏–∫–ª –ø–æ –≤—Å–µ–º m —á–∞—Å—Ç—è–º
current_len = base_len + (i <= remainder ? 1 : 0) # –¢–µ–∫—É—â–∞—è –¥–ª–∏–Ω–∞: –±–∞–∑–æ–≤–∞—è +1, –µ—Å–ª–∏ i ‚â§ –æ—Å—Ç–∞—Ç–∫–∞
push!(parts, N[idx:idx + current_len - 1]) # –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥—Å—Ç—Ä–æ–∫—É –≤ –º–∞—Å—Å–∏–≤ —á–∞—Å—Ç–µ–π
idx += current_len # –°–¥–≤–∏–≥–∞–µ–º –∏–Ω–¥–µ–∫—Å –Ω–∞ –¥–ª–∏–Ω—É —Ç–µ–∫—É—â–µ–π —á–∞—Å—Ç–∏
end
return parts # –í–æ–∑–≤—Ä–∞—â–∞–µ–º –º–∞—Å—Å–∏–≤ —Å—Ç—Ä–æ–∫-—á–∞—Å—Ç–µ–π
end

# –§—É–Ω–∫—Ü–∏—è: —É–º–Ω–æ–∂–∞–µ—Ç —á–∏—Å–ª–æ–≤—É—é —á–∞—Å—Ç—å (–∫–∞–∫ —Å—Ç—Ä–æ–∫—É) –Ω–∞ k –∏ –¥–æ–ø–æ–ª–Ω—è–µ—Ç —Å–ª–µ–≤–∞ –Ω—É–ª—è–º–∏ –¥–æ –∏—Å—Ö–æ–¥–Ω–æ–π –¥–ª–∏–Ω—ã –∏–ª–∏ –±–æ–ª—å—à–µ, –µ—Å–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª–∏–Ω–Ω–µ–µ
function multiply_preserve_length(part::String, k::Integer)
num = parse(BigInt, part) * k # –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º —Å—Ç—Ä–æ–∫—É –≤ BigInt, —É–º–Ω–æ–∂–∞–µ–º –Ω–∞ k
result = string(num) # –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ–±—Ä–∞—Ç–Ω–æ –≤ —Å—Ç—Ä–æ–∫—É
return lpad(result, max(length(part), length(result)), '0')  # –î–æ–ø–æ–ª–Ω—è–µ–º —Å–ª–µ–≤–∞ –Ω—É–ª—è–º–∏ –¥–æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –∏–∑ –¥–≤—É—Ö –¥–ª–∏–Ω
end

# –§—É–Ω–∫—Ü–∏—è: —É–¥–∞–ª—è–µ—Ç –≤–µ–¥—É—â–∏–µ –Ω—É–ª–∏ –∏–∑ —Å—Ç—Ä–æ–∫–∏; –µ—Å–ª–∏ —Å—Ç—Ä–æ–∫–∞ –ø—É—Å—Ç–∞—è ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç "0"
remove_leading_zeros(s::String) = s == "" ? "0" : lstrip(s, '0')  # –¢–µ—Ä–Ω–∞—Ä–Ω—ã–π –æ–ø–µ—Ä–∞—Ç–æ—Ä: –µ—Å–ª–∏ –ø—É—Å—Ç–æ ‚Üí "0", –∏–Ω–∞—á–µ —É–±—Ä–∞—Ç—å –Ω—É–ª–∏ —Å–ª–µ–≤–∞

# –§—É–Ω–∫—Ü–∏—è: —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç –¥–≤–∞ —Å—Ç—Ä–æ–∫–æ–≤—ã—Ö —á–∏—Å–ª–∞ PQ –∏ NK –ø–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—é –Ω–∞—á–∞–ª–∞ –∏/–∏–ª–∏ –∫–æ–Ω—Ü–∞ –ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è –≤–µ–¥—É—â–∏—Ö –Ω—É–ª–µ–π
function compare_pq_nk(pq::String, nk::String)
pq_clean = remove_leading_zeros(pq) # –£–¥–∞–ª—è–µ–º –≤–µ–¥—É—â–∏–µ –Ω—É–ª–∏ –∏–∑ PQ
nk_clean = remove_leading_zeros(nk) # –£–¥–∞–ª—è–µ–º –≤–µ–¥—É—â–∏–µ –Ω—É–ª–∏ –∏–∑ NK

if pq_clean == nk_clean # –ï—Å–ª–∏ —Å—Ç—Ä–æ–∫–∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–≤–ø–∞–¥–∞—é—Ç
return "‚úÖ –ü–æ–ª–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ" # –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
end

min_len = min(length(pq_clean), length(nk_clean)) # –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
prefix_match = 0 # –°—á—ë—Ç—á–∏–∫ —Å–æ–≤–ø–∞–¥–∞—é—â–∏—Ö —Å–∏–º–≤–æ–ª–æ–≤ —Å –Ω–∞—á–∞–ª–∞
suffix_match = 0 # –°—á—ë—Ç—á–∏–∫ —Å–æ–≤–ø–∞–¥–∞—é—â–∏—Ö —Å–∏–º–≤–æ–ª–æ–≤ —Å –∫–æ–Ω—Ü–∞

for i in 1:min_len # –¶–∏–∫–ª –ø–æ —Å–∏–º–≤–æ–ª–∞–º —Å –Ω–∞—á–∞–ª–∞
if pq_clean[i] == nk_clean[i] # –ï—Å–ª–∏ —Å–∏–º–≤–æ–ª—ã —Å–æ–≤–ø–∞–¥–∞—é—Ç
prefix_match += 1 # –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á—ë—Ç—á–∏–∫ –ø—Ä–µ—Ñ–∏–∫—Å–∞
else
break # –ò–Ω–∞—á–µ ‚Äî –≤—ã—Ö–æ–¥–∏–º –∏–∑ —Ü–∏–∫–ª–∞
end
end

for i in 1:min_len # –¶–∏–∫–ª –ø–æ —Å–∏–º–≤–æ–ª–∞–º —Å –∫–æ–Ω—Ü–∞ (i=1 ‚Üí –ø–æ—Å–ª–µ–¥–Ω–∏–π —Å–∏–º–≤–æ–ª)
if pq_clean[end - i + 1] == nk_clean[end - i + 1]  # –°—Ä–∞–≤–Ω–µ–Ω–∏–µ i-–≥–æ —Å–∏–º–≤–æ–ª–∞ —Å –∫–æ–Ω—Ü–∞
suffix_match += 1 # –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á—ë—Ç—á–∏–∫ —Å—É—Ñ—Ñ–∏–∫—Å–∞
else
break # –ò–Ω–∞—á–µ ‚Äî –≤—ã—Ö–æ–¥–∏–º –∏–∑ —Ü–∏–∫–ª–∞
end
end

if prefix_match > 0 && suffix_match > 0 # –ï—Å–ª–∏ –µ—Å—Ç—å —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è –∏ –≤ –Ω–∞—á–∞–ª–µ, –∏ –≤ –∫–æ–Ω—Ü–µ
return "üîÑ –°–æ–≤–ø–∞–¥–∞—é—Ç –Ω–∞—á–∞–ª–æ –∏ –∫–æ–Ω–µ—Ü" # –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
elseif suffix_match > 0 # –ï—Å–ª–∏ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Ç–æ–ª—å–∫–æ –∫–æ–Ω–µ—Ü
return "üîÑ –°–æ–≤–ø–∞–¥–∞–µ—Ç —Ç–æ–ª—å–∫–æ –∫–æ–Ω–µ—Ü" # –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
else
return "‚ùå –ù–µ—Ç —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π" # –ò–Ω–∞—á–µ ‚Äî –Ω–µ—Ç —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π
end
end

# –§—É–Ω–∫—Ü–∏—è: –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–ª—É—á–∞–π–Ω–æ–µ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–µ —Ü–µ–ª–æ–µ —á–∏—Å–ª–æ –∑–∞–¥–∞–Ω–Ω–æ–π —Ä–∞–∑—Ä—è–¥–Ω–æ—Å—Ç–∏ (digits)
function generate_random_number(digits::Int)
if digits == 1 # –ï—Å–ª–∏ –Ω—É–∂–Ω–∞ 1 —Ü–∏—Ñ—Ä–∞
return rand(1:9) # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ª—É—á–∞–π–Ω—É—é —Ü–∏—Ñ—Ä—É –æ—Ç 1 –¥–æ 9
else
first_digit = rand(1:9) # –ü–µ—Ä–≤–∞—è —Ü–∏—Ñ—Ä–∞ ‚Äî –æ—Ç 1 –¥–æ 9 (—á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ –≤–µ–¥—É—â–µ–≥–æ –Ω—É–ª—è)
other_digits = rand(0:9, digits - 1) # –û—Å—Ç–∞–ª—å–Ω—ã–µ ‚Äî –æ—Ç 0 –¥–æ 9, –≤—Å–µ–≥–æ (digits - 1) —à—Ç—É–∫
s = string(first_digit) * join(string.(other_digits)) # –°–æ–±–∏—Ä–∞–µ–º —Å—Ç—Ä–æ–∫—É: –ø–µ—Ä–≤–∞—è —Ü–∏—Ñ—Ä–∞ + –æ—Å—Ç–∞–ª—å–Ω—ã–µ
return parse(BigInt, s) # –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ BigInt –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º
end
end

# –§—É–Ω–∫—Ü–∏—è: –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –æ–¥–Ω–æ —Å–ª—É—á–∞–π–Ω–æ–µ —á–∏—Å–ª–æ –Ω–∞ —è–≤–ª–µ–Ω–∏–µ –°–ß–° (—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–æ–π —á–∏—Å–ª–æ–≤–æ–π —Å–∏–º–º–µ—Ç—Ä–∏–∏) –ø—Ä–∏ –∑–∞–¥–∞–Ω–Ω—ã—Ö m –∏ k
function check_scs_for_random_number(digits::Int, m::Int, k::Int)
N = generate_random_number(digits) # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ª—É—á–∞–π–Ω–æ–µ —á–∏—Å–ª–æ –∑–∞–¥–∞–Ω–Ω–æ–π —Ä–∞–∑—Ä—è–¥–Ω–æ—Å—Ç–∏
N_str = string(N) # –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –µ–≥–æ –≤ —Å—Ç—Ä–æ–∫—É

# –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ m, –µ—Å–ª–∏ –±–æ–ª—å—à–µ —Ä–∞–∑—Ä—è–¥–Ω–æ—Å—Ç–∏
actual_m = min(m, length(N_str)) # –ò—Å–ø–æ–ª—å–∑—É–µ–º min(m, –¥–ª–∏–Ω–∞ —á–∏—Å–ª–∞), —á—Ç–æ–±—ã –Ω–µ —Ä–∞–∑–±–∏–≤–∞—Ç—å –Ω–∞ –±–æ–ª—å—à–µ —á–∞—Å—Ç–µ–π, —á–µ–º —Ü–∏—Ñ—Ä

# –†–∞–∑–±–∏–µ–Ω–∏–µ –∏ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è
parts = split_number_str(N_str, actual_m) # –†–∞–∑–±–∏–≤–∞–µ–º —Å—Ç—Ä–æ–∫—É —á–∏—Å–ª–∞ –Ω–∞ actual_m —á–∞—Å—Ç–µ–π
pq_parts = [multiply_preserve_length(part, k) for part in parts]  # –£–º–Ω–æ–∂–∞–µ–º –∫–∞–∂–¥—É—é —á–∞—Å—Ç—å –Ω–∞ k —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –¥–ª–∏–Ω—ã
pq_str = join(pq_parts) # –û–±—ä–µ–¥–∏–Ω—è–µ–º —É–º–Ω–æ–∂–µ–Ω–Ω—ã–µ —á–∞—Å—Ç–∏ –≤ –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É PQ
nk_str = string(N * k) # –í—ã—á–∏—Å–ª—è–µ–º –ø–æ–ª–Ω–æ–µ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ N * k –∫–∞–∫ —Å—Ç—Ä–æ–∫—É NK
result_type = compare_pq_nk(pq_str, nk_str) # –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º PQ –∏ NK –ø–æ –ø—Ä–∞–≤–∏–ª–∞–º –°–ß–°

return ( # –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∏–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–π –∫–æ—Ä—Ç–µ–∂ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏
N = N, # –ò—Å—Ö–æ–¥–Ω–æ–µ —á–∏—Å–ª–æ (BigInt)
digits = digits, # –†–∞–∑—Ä—è–¥–Ω–æ—Å—Ç—å –∏—Å—Ö–æ–¥–Ω–æ–≥–æ —á–∏—Å–ª–∞
m = actual_m, # –§–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ —á–∏—Å–ª–æ –±–ª–æ–∫–æ–≤ (–ø–æ—Å–ª–µ –∫–æ—Ä—Ä–µ–∫—Ü–∏–∏)
k = k, # –ú–Ω–æ–∂–∏—Ç–µ–ª—å, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–π –≤ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–∏
parts = string(parts), # –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –º–∞—Å—Å–∏–≤ —á–∞—Å—Ç–µ–π –≤ —Å—Ç—Ä–æ–∫—É –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è
multiplied_parts = string(pq_parts), # –¢–æ –∂–µ –¥–ª—è —É–º–Ω–æ–∂–µ–Ω–Ω—ã—Ö —á–∞—Å—Ç–µ–π
PQ = remove_leading_zeros(pq_str), # PQ –±–µ–∑ –≤–µ–¥—É—â–∏—Ö –Ω—É–ª–µ–π
NK = remove_leading_zeros(nk_str), # NK –±–µ–∑ –≤–µ–¥—É—â–∏—Ö –Ω—É–ª–µ–π
result = result_type # –¢–∏–ø —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è (—Å—Ç—Ä–æ–∫–∞ —Å —ç–º–æ–¥–∑–∏ –∏ –æ–ø–∏—Å–∞–Ω–∏–µ–º)
)
end

# –ü–∞—Ä–∞–º–µ—Ç—Ä—ã
results_dir = "random_scs_results" # –ò–º—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
digits_list = [99] # –°–ø–∏—Å–æ–∫ —Ä–∞–∑—Ä—è–¥–Ω–æ—Å—Ç–µ–π –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ (–∑–¥–µ—Å—å ‚Äî —Ç–æ–ª—å–∫–æ 999)
num_per_digit = 1000 # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–ª—É—á–∞–π–Ω—ã—Ö —á–∏—Å–µ–ª –Ω–∞ –∫–∞–∂–¥—É—é —Ä–∞–∑—Ä—è–¥–Ω–æ—Å—Ç—å
m_list = [5] # –°–ø–∏—Å–æ–∫ –∑–Ω–∞—á–µ–Ω–∏–π m (—á–∏—Å–ª–æ –±–ª–æ–∫–æ–≤)
k_list = [5] # –°–ø–∏—Å–æ–∫ –∑–Ω–∞—á–µ–Ω–∏–π k (–º–Ω–æ–∂–∏—Ç–µ–ª—å)

# –ê—Ç–æ–º–∞—Ä–Ω—ã–µ —Å—á—ë—Ç—á–∏–∫–∏ –∏ Set –¥–ª—è –∏—Å–∫–ª—é—á–µ–Ω–∏—è –ø–æ–≤—Ç–æ—Ä–æ–≤
count_full = Atomic{Int}(0) # –ê—Ç–æ–º–∞—Ä–Ω—ã–π —Å—á—ë—Ç—á–∏–∫ –ø–æ–ª–Ω—ã—Ö —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π
count_both = Atomic{Int}(0) # –ê—Ç–æ–º–∞—Ä–Ω—ã–π —Å—á—ë—Ç—á–∏–∫ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π –Ω–∞—á–∞–ª–∞ –∏ –∫–æ–Ω—Ü–∞
count_end = Atomic{Int}(0) # –ê—Ç–æ–º–∞—Ä–Ω—ã–π —Å—á—ë—Ç—á–∏–∫ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π —Ç–æ–ª—å–∫–æ –∫–æ–Ω—Ü–∞
count_none = Atomic{Int}(0) # –ê—Ç–æ–º–∞—Ä–Ω—ã–π —Å—á—ë—Ç—á–∏–∫ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π
checked_numbers = Set{BigInt}() # –ú–Ω–æ–∂–µ—Å—Ç–≤–æ —É–∂–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö —á–∏—Å–µ–ª (–¥–ª—è –∏—Å–∫–ª—é—á–µ–Ω–∏—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤)
checked_lock = ReentrantLock() # –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –¥–ª—è –ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ checked_numbers
df_lock = ReentrantLock() # –ì–ª–æ–±–∞–ª—å–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –∑–∞–ø–∏—Å–∏ –≤ DataFrame

# DataFrame –¥–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
results_df = DataFrame( # –°–æ–∑–¥–∞—ë–º –ø—É—Å—Ç–æ–π DataFrame —Å —É–∫–∞–∑–∞–Ω–Ω—ã–º–∏ —Å—Ç–æ–ª–±—Ü–∞–º–∏
N = BigInt[], # –°—Ç–æ–ª–±–µ—Ü –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏—Å—Ö–æ–¥–Ω—ã—Ö —á–∏—Å–µ–ª (–ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ–π –¥–ª–∏–Ω—ã)
digits = Int[], # –°—Ç–æ–ª–±–µ—Ü –¥–ª—è —Ä–∞–∑—Ä—è–¥–Ω–æ—Å—Ç–∏ —á–∏—Å–ª–∞
m = Int[], # –°—Ç–æ–ª–±–µ—Ü –¥–ª—è —á–∏—Å–ª–∞ –±–ª–æ–∫–æ–≤ m
k = Int[], # –°—Ç–æ–ª–±–µ—Ü –¥–ª—è –º–Ω–æ–∂–∏—Ç–µ–ª—è k
parts = String[], # –°—Ç–æ–ª–±–µ—Ü –¥–ª—è —Å—Ç—Ä–æ–∫–æ–≤–æ–≥–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –±–ª–æ–∫–æ–≤ —á–∏—Å–ª–∞
multiplied_parts = String[], # –°—Ç–æ–ª–±–µ—Ü –¥–ª—è —Å—Ç—Ä–æ–∫–æ–≤–æ–≥–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è —É–º–Ω–æ–∂–µ–Ω–Ω—ã—Ö –±–ª–æ–∫–æ–≤
PQ = String[], # –°—Ç–æ–ª–±–µ—Ü –¥–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –ø–æ–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–Ω–æ–≥–æ —É–º–Ω–æ–∂–µ–Ω–∏—è (PQ)
NK = String[], # –°—Ç–æ–ª–±–µ—Ü –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è N*k (NK)
result = String[] # –°—Ç–æ–ª–±–µ—Ü –¥–ª—è —Ç–∏–ø–∞ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è (–∫–∞—Ç–µ–≥–æ—Ä–∏—è –°–ß–°)
)

# –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
if !isdir(results_dir) # –ï—Å–ª–∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
mkdir(results_dir) # –°–æ–∑–¥–∞—ë–º –µ—ë
end

# –ó–∞–ø—É—Å–∫ –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏
println("üöÄ –ó–∞–ø—É—Å–∫ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –°–ß–° –¥–ª—è –≤—Å–µ—Ö —á–∏—Å–µ–ª...") # –í—ã–≤–æ–¥ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –∫–æ–Ω—Å–æ–ª—å
println("üî¢ –ü—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è —Ä–∞–∑—Ä—è–¥–Ω–æ—Å—Ç–∏: $(digits_list)") # –í—ã–≤–æ–¥ —Å–ø–∏—Å–∫–∞ —Ä–∞–∑—Ä—è–¥–Ω–æ—Å—Ç–µ–π
println("üìä –ü–æ $num_per_digit —á–∏—Å–µ–ª –Ω–∞ –∫–∞–∂–¥—É—é —Ä–∞–∑—Ä—è–¥–Ω–æ—Å—Ç—å") # –í—ã–≤–æ–¥ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —á–∏—Å–µ–ª –Ω–∞ —Ä–∞–∑—Ä—è–¥–Ω–æ—Å—Ç—å
println("üìê m ‚àà $m_list, k ‚àà $k_list\n") # –í—ã–≤–æ–¥ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ m –∏ k

total_tasks = length(digits_list) * num_per_digit * length(m_list) * length(k_list)  # –û–±—â–µ–µ —á–∏—Å–ª–æ –∑–∞–¥–∞—á
progress = Progress(total_tasks, barglyphs=BarGlyphs("[=> ]")) # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–∞

Threads.@threads for digits in digits_list # –ú–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω—ã–π —Ü–∏–∫–ª –ø–æ —Ä–∞–∑—Ä—è–¥–Ω–æ—Å—Ç—è–º
for m in m_list # –¶–∏–∫–ª –ø–æ –∑–Ω–∞—á–µ–Ω–∏—è–º m
for k in k_list # –¶–∏–∫–ª –ø–æ –∑–Ω–∞—á–µ–Ω–∏—è–º k
for i in 1:num_per_digit # –¶–∏–∫–ª –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É —á–∏—Å–µ–ª –Ω–∞ –∫–æ–º–±–∏–Ω–∞—Ü–∏—é (digits, m, k)
res = check_scs_for_random_number(digits, m, k)  # –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–¥–Ω–æ —Å–ª—É—á–∞–π–Ω–æ–µ —á–∏—Å–ª–æ

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø–æ–≤—Ç–æ—Ä
skip = false # –§–ª–∞–≥: –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –ª–∏ —ç—Ç–æ —á–∏—Å–ª–æ
lock(checked_lock) do # –ë–ª–æ–∫–∏—Ä—É–µ–º –¥–æ—Å—Ç—É–ø –∫ –º–Ω–æ–∂–µ—Å—Ç–≤—É checked_numbers
if res.N in checked_numbers # –ï—Å–ª–∏ —á–∏—Å–ª–æ —É–∂–µ –ø—Ä–æ–≤–µ—Ä—è–ª–æ—Å—å
skip = true # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–ª–∞–≥ –ø—Ä–æ–ø—É—Å–∫–∞
else
push!(checked_numbers, res.N) # –ò–Ω–∞—á–µ –¥–æ–±–∞–≤–ª—è–µ–º –µ–≥–æ –≤ –º–Ω–æ–∂–µ—Å—Ç–≤–æ
end
end

if skip # –ï—Å–ª–∏ —á–∏—Å–ª–æ —É–∂–µ –±—ã–ª–æ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ
continue # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Ç–µ–∫—É—â—É—é –∏—Ç–µ—Ä–∞—Ü–∏—é
end

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á—ë—Ç—á–∏–∫–æ–≤
Threads.atomic_add!(count_full, res.result == "‚úÖ –ü–æ–ª–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ" ? 1 : 0)        # –£–≤–µ–ª–∏—á–∏—Ç—å —Å—á—ë—Ç—á–∏–∫ –ø–æ–ª–Ω—ã—Ö —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
Threads.atomic_add!(count_both, res.result == "üîÑ –°–æ–≤–ø–∞–¥–∞—é—Ç –Ω–∞—á–∞–ª–æ –∏ –∫–æ–Ω–µ—Ü" ? 1 : 0) # –¢–æ –∂–µ –¥–ª—è —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è –Ω–∞—á–∞–ª–∞ –∏ –∫–æ–Ω—Ü–∞
Threads.atomic_add!(count_end, res.result == "üîÑ –°–æ–≤–ø–∞–¥–∞–µ—Ç —Ç–æ–ª—å–∫–æ –∫–æ–Ω–µ—Ü" ? 1 : 0)    # –¢–æ –∂–µ –¥–ª—è —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –∫–æ–Ω—Ü–∞
Threads.atomic_add!(count_none, res.result == "‚ùå –ù–µ—Ç —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π" ? 1 : 0)           # –¢–æ –∂–µ –¥–ª—è –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π

# –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –∑–∞–ø–∏—Å—å –≤ DataFrame ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ–º –≥–ª–æ–±–∞–ª—å–Ω—É—é –±–ª–æ–∫–∏—Ä–æ–≤–∫—É
lock(df_lock) do # –ë–ª–æ–∫–∏—Ä—É–µ–º –¥–æ—Å—Ç—É–ø –∫ DataFrame —Å –ø–æ–º–æ—â—å—é df_lock
push!(results_df, [ # –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—É—é —Å—Ç—Ä–æ–∫—É –≤ DataFrame
res.N, # –ó–Ω–∞—á–µ–Ω–∏–µ N –∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
res.digits, # –ó–Ω–∞—á–µ–Ω–∏–µ digits –∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
res.m, # –ó–Ω–∞—á–µ–Ω–∏–µ m –∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
res.k, # –ó–Ω–∞—á–µ–Ω–∏–µ k –∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
res.parts, # –ó–Ω–∞—á–µ–Ω–∏–µ parts –∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
res.multiplied_parts, # –ó–Ω–∞—á–µ–Ω–∏–µ multiplied_parts –∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
res.PQ, # –ó–Ω–∞—á–µ–Ω–∏–µ PQ –∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
res.NK, # –ó–Ω–∞—á–µ–Ω–∏–µ NK –∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
res.result # –ó–Ω–∞—á–µ–Ω–∏–µ result –∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
])
end

next!(progress) # –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä
end
end
end
end

# –§–∏–Ω–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
full = count_full[] # –°—á–∏—Ç—ã–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –∞—Ç–æ–º–∞—Ä–Ω–æ–≥–æ —Å—á—ë—Ç—á–∏–∫–∞ –ø–æ–ª–Ω—ã—Ö —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π
both = count_both[] # –°—á–∏—Ç—ã–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ —Å—á—ë—Ç—á–∏–∫–∞ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π –Ω–∞—á–∞–ª–∞ –∏ –∫–æ–Ω—Ü–∞
end_only = count_end[] # –°—á–∏—Ç—ã–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ —Å—á—ë—Ç—á–∏–∫–∞ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π —Ç–æ–ª—å–∫–æ –∫–æ–Ω—Ü–∞
none = count_none[] # –°—á–∏—Ç—ã–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ —Å—á—ë—Ç—á–∏–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π

# –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
csv_file = joinpath(results_dir, "universal_scs_results.csv")  # –§–æ—Ä–º–∏—Ä—É–µ–º –ø—É—Ç—å –∫ CSV-—Ñ–∞–π–ª—É
txt_file = joinpath(results_dir, "universal_scs_statistics.txt") # –§–æ—Ä–º–∏—Ä—É–µ–º –ø—É—Ç—å –∫ TXT-—Ñ–∞–π–ª—É —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

CSV.write(csv_file, results_df) # –ó–∞–ø–∏—Å—ã–≤–∞–µ–º DataFrame –≤ CSV-—Ñ–∞–π–ª
println("\nüíæ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ CSV: $csv_file")  # –í—ã–≤–æ–¥ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± —É—Å–ø–µ—à–Ω–æ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
open(txt_file, "w") do io # –û—Ç–∫—Ä—ã–≤–∞–µ–º —Ç–µ–∫—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª –¥–ª—è –∑–∞–ø–∏—Å–∏
write(io, "üìä –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –°–ß–°\n") # –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫
write(io, "==================================================\n")  # –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å
write(io, "–†–∞–∑—Ä—è–¥–Ω–æ—Å—Ç–∏: $(digits_list)\n") # –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ —Ä–∞–∑—Ä—è–¥–Ω–æ—Å—Ç–∏
write(io, "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∏—Å–µ–ª –Ω–∞ —Ä–∞–∑—Ä—è–¥–Ω–æ—Å—Ç—å: $num_per_digit\n")  # –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∏—Å–µ–ª
write(io, "–ó–Ω–∞—á–µ–Ω–∏—è m: $m_list\n") # –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è m
write(io, "–ó–Ω–∞—á–µ–Ω–∏—è k: $k_list\n") # –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è k
write(io, "-----------------------------------------\n")  # –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å
@printf(io, "–ü–æ–ª–Ω—ã–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è: %d\n", full) # –ó–∞–ø–∏—Å—ã–≤–∞–µ–º —á–∏—Å–ª–æ –ø–æ–ª–Ω—ã—Ö —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π
@printf(io, "–°–æ–≤–ø–∞–¥–∞—é—Ç –Ω–∞—á–∞–ª–æ –∏ –∫–æ–Ω–µ—Ü: %d\n", both)  # –ó–∞–ø–∏—Å—ã–≤–∞–µ–º —á–∏—Å–ª–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π –Ω–∞—á–∞–ª–∞ –∏ –∫–æ–Ω—Ü–∞
@printf(io, "–°–æ–≤–ø–∞–¥–∞–µ—Ç —Ç–æ–ª—å–∫–æ –∫–æ–Ω–µ—Ü: %d\n", end_only)  # –ó–∞–ø–∏—Å—ã–≤–∞–µ–º —á–∏—Å–ª–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π —Ç–æ–ª—å–∫–æ –∫–æ–Ω—Ü–∞
@printf(io, "–ù–µ—Ç —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π: %d\n", none) # –ó–∞–ø–∏—Å—ã–≤–∞–µ–º —á–∏—Å–ª–æ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–π —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π
write(io, "\n–í—Å–µ –¥–∞–Ω–Ω—ã–µ ‚Äî –≤ —Ñ–∞–π–ª–µ 'universal_scs_results.csv'\n")  # –£–∫–∞–∑–∞–Ω–∏–µ –Ω–∞ CSV-—Ñ–∞–π–ª
end

println("üìÑ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –≤: $txt_file") # –í—ã–≤–æ–¥ —Å–æ–æ–±—â–µ–Ω–∏—è –æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
println("‚úÖ –ê–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à—ë–Ω!") # –í—ã–≤–æ–¥ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ–∫–æ–Ω—á–∞–Ω–∏–∏
@printf("üîç –ù–∞–π–¥–µ–Ω–æ –ø–æ–ª–Ω—ã—Ö —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π: %d –∏–∑ %d (%.4f%%)\n", full, total_tasks, full / total_tasks * 100)  # –í—ã–≤–æ–¥ –∏—Ç–æ–≥–æ–≤–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Å –ø—Ä–æ—Ü–µ–Ω—Ç–æ–º