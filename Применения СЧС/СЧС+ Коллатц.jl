# –ò–º–ø–æ—Ä—Ç –ø–∞–∫–µ—Ç–æ–≤
# –ó–∞–≥—Ä—É–∂–∞–µ–º –≤–Ω–µ—à–Ω–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ (–º–æ–¥—É–ª–∏), –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–ª—è —Ä–∞–±–æ—Ç—ã –ø—Ä–æ–≥—Ä–∞–º–º—ã.
using Printf                 # –ü–∞–∫–µ—Ç –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω–æ–≥–æ –≤—ã–≤–æ–¥–∞
using CSV                    # –ü–∞–∫–µ—Ç –¥–ª—è —á—Ç–µ–Ω–∏—è –∏ –∑–∞–ø–∏—Å–∏ –¥–∞–Ω–Ω—ã—Ö –≤ —Ñ–æ—Ä–º–∞—Ç–µ CSV (Comma-Separated Values).
using DataFrames             # –ü–∞–∫–µ—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ç–∞–±–ª–∏—á–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ (–∞–Ω–∞–ª–æ–≥ —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã –≤ –ø–∞–º—è—Ç–∏).
using Base.Threads           # –ú–æ–¥—É–ª—å Julia –¥–ª—è –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç–∏; –Ω—É–∂–µ–Ω –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—á—ë—Ç—á–∏–∫–æ–≤.
using Plots                  # –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –ø–∞–∫–µ—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–æ–≤ –∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–π.
using FFMPEG                 # –ü–∞–∫–µ—Ç, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å FFmpeg –¥–ª—è —Å–±–æ—Ä–∫–∏ –≤–∏–¥–µ–æ –∏–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π.

# –§—É–Ω–∫—Ü–∏—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
# –≠—Ç–∏ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å, —á—Ç–æ–±—ã –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç –ø–æ–¥ —Å–≤–æ–∏ –Ω—É–∂–¥—ã.
# –ù–∞—á–∞–ª—å–Ω–æ–µ —á–∏—Å–ª–æ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ö–æ–ª–ª–∞—Ç—Ü–∞. –≠—Ç–æ —á–∏—Å–ª–æ –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–∫–æ–ª—å —É–≥–æ–¥–Ω–æ –±–æ–ª—å—à–∏–º –±–ª–∞–≥–æ–¥–∞—Ä—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é BigInt.
const N_START = big"9"^big"999"  # 9 –≤ —Å—Ç–µ–ø–µ–Ω–∏ 999 ‚Äî –≥–∏–≥–∞–Ω—Ç—Å–∫–æ–µ —á–∏—Å–ª–æ.

# –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∞—Å—Ç–µ–π, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥–µ—Ç —Ä–∞–∑–±–∏–≤–∞—Ç—å—Å—è —á–∏—Å–ª–æ N –ø—Ä–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–∏ –°–ß–°.
# –ù–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏ M_SNS = 2 —á–∏—Å–ª–æ –¥–µ–ª–∏—Ç—Å—è –ø–æ–ø–æ–ª–∞–º.
const M_SNS = 2

# –ú–Ω–æ–∂–∏—Ç–µ–ª—å, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–π —É–º–Ω–æ–∂–∞–µ—Ç—Å—è –∫–∞–∂–¥–∞—è —á–∞—Å—Ç—å —á–∏—Å–ª–∞ –≤ –º–µ—Ç–æ–¥–µ –°–ß–°.
# –í–ª–∏—è–µ—Ç –Ω–∞ —Ñ–æ—Ä–º—É PQ –∏ —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç—Å—è —Å N *K_SNS.
const K_SNS = 3

# –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —à–∞–≥–æ–≤ –≤ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ö–æ–ª–ª–∞—Ç—Ü–∞.
# –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ, —á—Ç–æ–±—ã –ø—Ä–æ–≥—Ä–∞–º–º–∞ –Ω–µ —Ä–∞–±–æ—Ç–∞–ª–∞ –≤–µ—á–Ω–æ (–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—á–µ–Ω—å –¥–ª–∏–Ω–Ω–æ–π).
const MAX_ITERATIONS = 1000

# –§—É–Ω–∫—Ü–∏—è —Ä–∞–∑–±–∏—Ç—å —á–∏—Å–ª–æ –Ω–∞ —Ä–∞–≤–Ω—ã–µ —á–∞—Å—Ç–∏
# –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –¥–µ–ª–∏—Ç —Å—Ç—Ä–æ–∫–æ–≤–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —á–∏—Å–ª–∞ –Ω–∞ m —á–∞—Å—Ç–µ–π, —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—è —Ü–∏—Ñ—Ä—ã –∫–∞–∫ –º–æ–∂–Ω–æ —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–µ–µ.
# –ù–∞–ø—Ä–∏–º–µ—Ä, —á–∏—Å–ª–æ "12345" –ø—Ä–∏ m=2 ‚Üí ["123", "45"].
function split_number_str(N::Integer, m::Integer)
s = string(N)                        # –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤—Ö–æ–¥–Ω–æ–µ —á–∏—Å–ª–æ N –≤ —Å—Ç—Ä–æ–∫—É —Ü–∏—Ñ—Ä.
if length(s) < m                     # –ï—Å–ª–∏ –≤ —á–∏—Å–ª–µ –º–µ–Ω—å—à–µ —Ü–∏—Ñ—Ä, —á–µ–º —á–∞—Å—Ç–µ–π...
s = lpad(s, m, '0')                  # ...–¥–æ–±–∞–≤–ª—è–µ–º –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –Ω—É–ª–∏ —Å–ª–µ–≤–∞, —á—Ç–æ–±—ã –±—ã–ª–æ —Ä–æ–≤–Ω–æ m —Å–∏–º–≤–æ–ª–æ–≤.
end
len = length(s)                      # –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–ª–∏–Ω—É —Å—Ç—Ä–æ–∫–∏ –¥–ª—è —Ä–∞—Å—á—ë—Ç–æ–≤.
base_len = div(len, m)               # –ë–∞–∑–æ–≤–∞—è –¥–ª–∏–Ω–∞ –∫–∞–∂–¥–æ–π —á–∞—Å—Ç–∏ (—Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω–æ–µ –¥–µ–ª–µ–Ω–∏–µ).
remainder = len % m                  # –û—Å—Ç–∞—Ç–æ–∫ –æ—Ç –¥–µ–ª–µ–Ω–∏—è: —Å–∫–æ–ª—å–∫–æ —á–∞—Å—Ç–µ–π –±—É–¥—É—Ç –¥–ª–∏–Ω–Ω–µ–µ –Ω–∞ 1 —Å–∏–º–≤–æ–ª.
parts = String[]                     # –°–æ–∑–¥–∞—ë–º –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —á–∞—Å—Ç–µ–π (–∫–∞–∫ —Å—Ç—Ä–æ–∫–∏).
idx = 1                              # –ù–∞—á–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å –≤ —Å—Ç—Ä–æ–∫–µ s (Julia –∏—Å–ø–æ–ª—å–∑—É–µ—Ç 1-based –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—é).
for i in 1:m                         # –¶–∏–∫–ª –ø–æ –∫–∞–∂–¥–æ–π –∏–∑ m —á–∞—Å—Ç–µ–π.
# –û–ø—Ä–µ–¥–µ–ª—è–µ–º –¥–ª–∏–Ω—É —Ç–µ–∫—É—â–µ–π —á–∞—Å—Ç–∏:
current_len = base_len + (i <= remainder ? 1 : 0) # –µ—Å–ª–∏ –Ω–æ–º–µ—Ä —á–∞—Å—Ç–∏ i <= –æ—Å—Ç–∞—Ç–∫–∞, —Ç–æ –¥–æ–±–∞–≤–ª—è–µ–º 1 –∫ –±–∞–∑–æ–≤–æ–π –¥–ª–∏–Ω–µ.
push!(parts, s[idx:idx+current_len-1]) # –ò–∑–≤–ª–µ–∫–∞–µ–º –ø–æ–¥—Å—Ç—Ä–æ–∫—É –∏–∑ s —Å –ø–æ–∑–∏—Ü–∏–∏ idx –¥–ª–∏–Ω–æ–π current_len –∏ –¥–æ–±–∞–≤–ª—è–µ–º –≤ –º–∞—Å—Å–∏–≤ —á–∞—Å—Ç–µ–π.
idx += current_len                     # –°–¥–≤–∏–≥–∞–µ–º –∏–Ω–¥–µ–∫—Å –Ω–∞ –¥–ª–∏–Ω—É —Ç–æ–ª—å–∫–æ —á—Ç–æ –≤–∑—è—Ç–æ–π —á–∞—Å—Ç–∏.
end
return parts                           # –í–æ–∑–≤—Ä–∞—â–∞–µ–º –º–∞—Å—Å–∏–≤ —Å—Ç—Ä–æ–∫ ‚Äî —á–∞—Å—Ç–∏ —á–∏—Å–ª–∞.
end

# –§—É–Ω–∫—Ü–∏—è —É–º–Ω–æ–∂–∏—Ç—å —á–∞—Å—Ç—å, –Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –µ—ë –¥–ª–∏–Ω—É 
# –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è —É–º–Ω–æ–∂–∞–µ—Ç —á–∏—Å–ª–æ–≤—É—é —Å—Ç—Ä–æ–∫—É –Ω–∞ k, –Ω–æ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –µ—ë –∏—Å—Ö–æ–¥–Ω—É—é –¥–ª–∏–Ω—É, –¥–æ–ø–æ–ª–Ω—è—è –Ω—É–ª—è–º–∏ —Å–ª–µ–≤–∞ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.
function multiply_preserve_length(part::String, k::Integer)
num = parse(BigInt, part) * k            # –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º —Å—Ç—Ä–æ–∫—É –≤ –±–æ–ª—å—à–æ–µ —Ü–µ–ª–æ–µ —á–∏—Å–ª–æ, —É–º–Ω–æ–∂–∞–µ–º –Ω–∞ k.
result = string(num)                     # –†–µ–∑—É–ª—å—Ç–∞—Ç —É–º–Ω–æ–∂–µ–Ω–∏—è —Å–Ω–æ–≤–∞ –ø—Ä–µ–≤—Ä–∞—â–∞–µ–º –≤ —Å—Ç—Ä–æ–∫—É.
# –î–æ–ø–æ–ª–Ω—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –Ω—É–ª—è–º–∏ —Å–ª–µ–≤–∞ –¥–æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –∏–∑ –¥–≤—É—Ö –¥–ª–∏–Ω: –∏—Å—Ö–æ–¥–Ω–æ–π –∏ –Ω–æ–≤–æ–π.
return lpad(result, max(length(part), length(result)), '0') # –≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –¥–ª–∏–Ω–∞ –Ω–µ —É–º–µ–Ω—å—à–∏—Ç—Å—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, "005" * 2 = "010", –∞ –Ω–µ "10").
end

# –§—É–Ω–∫—Ü–∏—è —É–¥–∞–ª–∏—Ç—å –≤–µ–¥—É—é—â–∏–µ –Ω—É–ª–∏
# –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è —É–¥–∞–ª—è–µ—Ç –Ω—É–ª–∏ –≤ –Ω–∞—á–∞–ª–µ —Å—Ç—Ä–æ–∫–∏, –Ω–æ –æ—Å—Ç–∞–≤–ª—è–µ—Ç —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω "0", –µ—Å–ª–∏ —Å—Ç—Ä–æ–∫–∞ —Å–æ—Å—Ç–æ–∏—Ç —Ç–æ–ª—å–∫–æ –∏–∑ –Ω—É–ª–µ–π.
function remove_leading_zeros(s::String)
if all(c -> c == '0', s)                    # –ü—Ä–æ–≤–µ—Ä—è–µ–º: –≤—Å–µ –ª–∏ —Å–∏–º–≤–æ–ª—ã –≤ —Å—Ç—Ä–æ–∫–µ ‚Äî '0'?
return "0"                                  # –ï—Å–ª–∏ –¥–∞ ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ–º "0" (–ø–æ –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –ø—Ä–∞–≤–∏–ª–∞–º).
else
idx = findfirst(c -> c != '0', s)           # –ò—â–µ–º –ø–æ–∑–∏—Ü–∏—é –ø–µ—Ä–≤–æ–≥–æ –Ω–µ–Ω—É–ª–µ–≤–æ–≥–æ —Å–∏–º–≤–æ–ª–∞.
# –ï—Å–ª–∏ —Ç–∞–∫–æ–π —Å–∏–º–≤–æ–ª –Ω–∞–π–¥–µ–Ω ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –ø–æ–¥—Å—Ç—Ä–æ–∫—É –æ—Ç –Ω–µ–≥–æ –¥–æ –∫–æ–Ω—Ü–∞.
return idx === nothing ? "0" : s[idx:end]   # –ï—Å–ª–∏ –Ω–µ—Ç (—Ç–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –∏–∑-–∑–∞ —É—Å–ª–æ–≤–∏—è –≤—ã—à–µ) ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ–º "0".
end
end

# –§—É–Ω–∫—Ü–∏—è —Å—Ä–∞–≤–Ω–∏—Ç—å PQ –ò NK
# –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç –¥–≤–∞ —á–∏—Å–ª–∞ (–≤ –≤–∏–¥–µ —Å—Ç—Ä–æ–∫) –ø–æ –Ω–∞—á–∞–ª—É –∏ –∫–æ–Ω—Ü—É,
# —á—Ç–æ–±—ã –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ç–∏–ø —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è –≤ —Ä–∞–º–∫–∞—Ö –°–ß–°.
function compare_pq_nk(pq::String, nk::String)
pq_clean = remove_leading_zeros(pq)            # –£–¥–∞–ª—è–µ–º –≤–µ–¥—É—â–∏–µ –Ω—É–ª–∏ –∏–∑ –ª–µ–≤–æ–π —á–∞—Å—Ç–∏ (PQ).
nk_clean = remove_leading_zeros(nk)            # –£–¥–∞–ª—è–µ–º –≤–µ–¥—É—â–∏–µ –Ω—É–ª–∏ –∏–∑ –ø—Ä–∞–≤–æ–π —á–∞—Å—Ç–∏ (NK).

if pq_clean == nk_clean                         # –ï—Å–ª–∏ —Å—Ç—Ä–æ–∫–∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–¥–µ–Ω—Ç–∏—á–Ω—ã...
return "‚úÖ –ü–æ–ª–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ"                   # ...–≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —Å—Ç–∞—Ç—É—Å.
end

min_len = min(length(pq_clean), length(nk_clean)) # –ù–∞—Ö–æ–¥–∏–º –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é –¥–ª–∏–Ω—É –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è.
prefix_match = suffix_match = 0                   # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å—á—ë—Ç—á–∏–∫–∏ —Å–æ–≤–ø–∞–¥–∞—é—â–∏—Ö —Å–∏–º–≤–æ–ª–æ–≤ –≤ –Ω–∞—á–∞–ª–µ –∏ –∫–æ–Ω—Ü–µ.

# –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º —Å–∏–º–≤–æ–ª—ã —Å –Ω–∞—á–∞–ª–∞ (—Å–ª–µ–≤–∞ –Ω–∞–ø—Ä–∞–≤–æ), –ø–æ–∫–∞ –Ω–µ –Ω–∞–π–¥—ë–º –ø–µ—Ä–≤–æ–µ –Ω–µ—Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ.
for i in 1:min_len                                 # –ï—Å–ª–∏ i-–π —Å–∏–º–≤–æ–ª —Å–æ–≤–ø–∞–¥–∞–µ—Ç ‚Äî —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á—ë—Ç—á–∏–∫ –ø—Ä–µ—Ñ–∏–∫—Å–∞.
pq_clean[i] == nk_clean[i] ? prefix_match += 1 : break # –ï—Å–ª–∏ –Ω–µ—Ç ‚Äî –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ –ø—Ä–µ—Ä—ã–≤–∞–µ–º —Ü–∏–∫–ª (break), —Ç–∞–∫ –∫–∞–∫ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω—ã–º.
end

# –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º —Å–∏–º–≤–æ–ª—ã —Å –∫–æ–Ω—Ü–∞ (—Å–ø—Ä–∞–≤–∞ –Ω–∞–ª–µ–≤–æ), –ø–æ–∫–∞ –Ω–µ –Ω–∞–π–¥—ë–º –ø–µ—Ä–≤–æ–µ –Ω–µ—Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ.
for i in 1:min_len                                  # –ü–æ–∑–∏—Ü–∏—è i-–≥–æ —Å–∏–º–≤–æ–ª–∞ —Å –∫–æ–Ω—Ü–∞: end - i + 1.
pq_clean[end - i + 1] == nk_clean[end - i + 1] ? suffix_match += 1 : break # –ï—Å–ª–∏ —Å–æ–≤–ø–∞–¥–∞–µ—Ç ‚Äî —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á—ë—Ç—á–∏–∫ —Å—É—Ñ—Ñ–∏–∫—Å–∞, –∏–Ω–∞—á–µ ‚Äî –≤—ã—Ö–æ–¥–∏–º.
end

# –ù–∞ –æ—Å–Ω–æ–≤–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö —Å—á—ë—Ç—á–∏–∫–æ–≤ –æ–ø—Ä–µ–¥–µ–ª—è–µ–º –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Ç–∏–ø —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è:
if prefix_match > 0 && suffix_match > 0
return "üîÑ –°–æ–≤–ø–∞–¥–µ–Ω–∏–µ –Ω–∞—á–∞–ª–∞ –∏ –∫–æ–Ω—Ü–∞"
elseif prefix_match > 0
return "üîÑ –°–æ–≤–ø–∞–¥–∞–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–∞—á–∞–ª–æ"
elseif suffix_match > 0
return "üîÑ –°–æ–≤–ø–∞–¥–∞–µ—Ç —Ç–æ–ª—å–∫–æ –∫–æ–Ω–µ—Ü"
else
return "‚ùå –ù–µ—Ç —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π"
end
end

# –§—É–Ω–∫—Ü–∏—è –æ–¥–∏–Ω —à–∞–≥ –ö–æ–ª–ª–∞—Ç—Ü–∞
# –†–µ–∞–ª–∏–∑—É–µ—Ç –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–µ –ø—Ä–∞–≤–∏–ª–æ –≥–∏–ø–æ—Ç–µ–∑—ã –ö–æ–ª–ª–∞—Ç—Ü–∞:
# –µ—Å–ª–∏ —á–∏—Å–ª–æ —á—ë—Ç–Ω–æ–µ ‚Äî –¥–µ–ª–∏–º –Ω–∞ 2; –µ—Å–ª–∏ –Ω–µ—á—ë—Ç–Ω–æ–µ ‚Äî —É–º–Ω–æ–∂–∞–µ–º –Ω–∞ 3 –∏ –ø—Ä–∏–±–∞–≤–ª—è–µ–º 1.
function collatz_step(N::BigInt)
return iseven(N) ? N √∑ 2 : 3 * N + 1 # –¢–µ—Ä–Ω–∞—Ä–Ω—ã–π –æ–ø–µ—Ä–∞—Ç–æ—Ä: –µ—Å–ª–∏ iseven(N) ‚Äî true, —Ç–æ N √∑ 2, –∏–Ω–∞—á–µ 3*N + 1.
end

# –§—É–Ω–∫—Ü–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–∏ –°–ß–° –∫ –∫–∞–∂–¥–æ–º—É —à–∞–≥—É –ö–æ–ª–ª–∞—Ç—Ü–∞ 
# –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç –ø–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –°–ß–° –¥–ª—è –∑–∞–¥–∞–Ω–Ω–æ–≥–æ —á–∏—Å–ª–∞ N —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ m –∏ k.
function chek_sNs_for_collatz_step(N::BigInt, m::Integer, k::Integer)
N_str = string(N)                       # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Ç—Ä–æ–∫–æ–≤–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ N (–¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –∏ –ª–æ–≥–æ–≤).
nk_str = string(N * k)                  # –í—ã—á–∏—Å–ª—è–µ–º N * k –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –∫–∞–∫ —Å—Ç—Ä–æ–∫—É.
parts_str = split_number_str(N, m)      # –†–∞–∑–±–∏–≤–∞–µ–º N –Ω–∞ m —á–∞—Å—Ç–µ–π (–∫–∞–∫ —Å—Ç—Ä–æ–∫–∏).
multiplied_parts_str = [multiply_preserve_length(p, k) for p in parts_str] # –£–º–Ω–æ–∂–∞–µ–º –∫–∞–∂–¥—É—é —á–∞—Å—Ç—å –Ω–∞ k, —Å–æ—Ö—Ä–∞–Ω—è—è –¥–ª–∏–Ω—É (—Å –ø–æ–º–æ—â—å—é —Ñ—É–Ω–∫—Ü–∏–∏ multiply_preserve_length).
pq_str = join(multiplied_parts_str)      # –°–æ–±–∏—Ä–∞–µ–º –∏–∑ —É–º–Ω–æ–∂–µ–Ω–Ω—ã—Ö —á–∞—Å—Ç–µ–π –Ω–æ–≤—É—é —Å—Ç—Ä–æ–∫—É PQ.

pq_clean = remove_leading_zeros(pq_str)   # –£–¥–∞–ª—è–µ–º –≤–µ–¥—É—â–∏–µ –Ω—É–ª–∏ –∏–∑ PQ.
nk_clean = remove_leading_zeros(nk_str)   # –£–¥–∞–ª—è–µ–º –≤–µ–¥—É—â–∏–µ –Ω—É–ª–∏ –∏–∑ NK.

result = compare_pq_nk(pq_clean, nk_clean) # –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º PQ –∏ NK, –ø–æ–ª—É—á–∞–µ–º —Ç–∏–ø —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è.

# –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∏–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–π –∫–æ—Ä—Ç–µ–∂ —Å–æ –≤—Å–µ–º–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ (—à–∞–≥ –±—É–¥–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø–æ–∑–∂–µ).
return (
step = 0,                        # –ó–∞–≥–ª—É—à–∫–∞; –Ω–∞—Å—Ç–æ—è—â–∏–π –Ω–æ–º–µ—Ä —à–∞–≥–∞ –ø—Ä–∏—Å–≤–∞–∏–≤–∞–µ—Ç—Å—è –≤ –æ—Å–Ω–æ–≤–Ω–æ–º —Ü–∏–∫–ª–µ.
N = N,                           # –ò—Å—Ö–æ–¥–Ω–æ–µ —á–∏—Å–ª–æ –Ω–∞ —ç—Ç–æ–º —à–∞–≥–µ.
parts = string(parts_str),       # –°—Ç—Ä–æ–∫–æ–≤–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –º–∞—Å—Å–∏–≤–∞ —á–∞—Å—Ç–µ–π (–¥–ª—è CSV).
multiplied_parts = string(multiplied_parts_str), # –¢–æ –∂–µ –¥–ª—è —É–º–Ω–æ–∂–µ–Ω–Ω—ã—Ö —á–∞—Å—Ç–µ–π.
PQ = pq_clean,                   # –ß–∏—Å–ª–æ PQ –ø–æ—Å–ª–µ –æ—á–∏—Å—Ç–∫–∏.
NK = nk_clean,                   # –ß–∏—Å–ª–æ NK –ø–æ—Å–ª–µ –æ—á–∏—Å—Ç–∫–∏.
result = result                  # –¢–∏–ø —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è (—Ç–µ–∫—Å—Ç–æ–≤–∞—è —Å—Ç—Ä–æ–∫–∞).
    )
end

# –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
# –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–ø—É—Å–∫–∞–µ—Ç –ø–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ö–æ–ª–ª–∞—Ç—Ü–∞ —Å –°–ß–° –∏ —Å–æ–∑–¥–∞—ë—Ç –≤—Å–µ –≤—ã—Ö–æ–¥–Ω—ã–µ —Ñ–∞–π–ª—ã.
function run_collatz_with_sns_analysis(N::BigInt, m::Integer, k::Integer, max_steps::Integer)
# –°–æ–∑–¥–∞—ë–º –ø—É—Å—Ç—É—é —Ç–∞–±–ª–∏—Ü—É (DataFrame) –¥–ª—è –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ –∫–∞–∂–¥–æ–º—É —à–∞–≥—É.
results_df = DataFrame(
step = Int[],                    # –°—Ç–æ–ª–±–µ—Ü –¥–ª—è –Ω–æ–º–µ—Ä–∞ —à–∞–≥–∞ (—Ü–µ–ª—ã–µ —á–∏—Å–ª–∞).
N = BigInt[],                    # –°—Ç–æ–ª–±–µ—Ü –¥–ª—è —Å–∞–º–æ–≥–æ —á–∏—Å–ª–∞ (–ø–æ–¥–¥–µ—Ä–∂–∫–∞ –±–æ–ª—å—à–∏—Ö —á–∏—Å–µ–ª).
parts = String[],                # –°—Ç–æ–ª–±–µ—Ü –¥–ª—è —Å—Ç—Ä–æ–∫–æ–≤–æ–≥–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è —á–∞—Å—Ç–µ–π.
multiplied_parts = String[],     # –°—Ç–æ–ª–±–µ—Ü –¥–ª—è —Å—Ç—Ä–æ–∫–æ–≤–æ–≥–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è —É–º–Ω–æ–∂–µ–Ω–Ω—ã—Ö —á–∞—Å—Ç–µ–π.
PQ = String[],                   # –°—Ç–æ–ª–±–µ—Ü –¥–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ PQ.
NK = String[],                   # –°—Ç–æ–ª–±–µ—Ü –¥–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ NK.
result = String[]                # –°—Ç–æ–ª–±–µ—Ü –¥–ª—è —Ç–∏–ø–∞ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è.
    )

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ —Å—á—ë—Ç—á–∏–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è.
full_matches = Atomic{Int}(0)     # –°—á—ë—Ç—á–∏–∫ –ø–æ–ª–Ω—ã—Ö —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π.
partial_both = Atomic{Int}(0)     # –°—á—ë—Ç—á–∏–∫ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π –Ω–∞—á–∞–ª–∞ –∏ –∫–æ–Ω—Ü–∞.
partial_start = Atomic{Int}(0)    # –°—á—ë—Ç—á–∏–∫ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π —Ç–æ–ª—å–∫–æ –Ω–∞—á–∞–ª–∞.
partial_end = Atomic{Int}(0)      # –°—á—ë—Ç—á–∏–∫ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π —Ç–æ–ª—å–∫–æ –∫–æ–Ω—Ü–∞.
no_matches = Atomic{Int}(0)       # –°—á—ë—Ç—á–∏–∫ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π.

current_N = N                      # –¢–µ–∫—É—â–µ–µ —á–∏—Å–ª–æ –≤ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (–Ω–∞—á–∏–Ω–∞–µ–º —Å N_START).
step_count = 0                     # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å—á—ë—Ç—á–∏–∫ —à–∞–≥–æ–≤ (–Ω–∞—á–Ω—ë—Ç—Å—è —Å 1).

# –°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö –ø–æ —à–∞–≥–∞–º
for _ in 1:max_steps                # –û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª: –≤—ã–ø–æ–ª–Ω—è–µ–º –Ω–µ –±–æ–ª–µ–µ max_steps —à–∞–≥–æ–≤ –ö–æ–ª–ª–∞—Ç—Ü–∞.
step_count += 1                     # –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –Ω–æ–º–µ—Ä —à–∞–≥–∞ (1, 2, 3, ...).

res = chek_sNs_for_collatz_step(current_N, m, k) # –ü—Ä–∏–º–µ–Ω—è–µ–º –°–ß–° –∫ —Ç–µ–∫—É—â–µ–º—É —á–∏—Å–ª—É.

# –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —Å—á—ë—Ç—á–∏–∫ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è.
# –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ—Ä–Ω–∞—Ä–Ω—ã–π –æ–ø–µ—Ä–∞—Ç–æ—Ä: –µ—Å–ª–∏ —É—Å–ª–æ–≤–∏–µ –∏—Å—Ç–∏–Ω–Ω–æ ‚Äî –ø—Ä–∏–±–∞–≤–ª—è–µ–º 1, –∏–Ω–∞—á–µ 0.
Threads.atomic_add!(full_matches, res.result == "‚úÖ –ü–æ–ª–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ" ? 1 : 0)
Threads.atomic_add!(partial_both, res.result == "üîÑ –°–æ–≤–ø–∞–¥–µ–Ω–∏–µ –Ω–∞—á–∞–ª–∞ –∏ –∫–æ–Ω—Ü–∞" ? 1 : 0)
Threads.atomic_add!(partial_start, res.result == "üîÑ –°–æ–≤–ø–∞–¥–∞–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–∞—á–∞–ª–æ" ? 1 : 0)
Threads.atomic_add!(partial_end, res.result == "üîÑ –°–æ–≤–ø–∞–¥–∞–µ—Ç —Ç–æ–ª—å–∫–æ –∫–æ–Ω–µ—Ü" ? 1 : 0)
Threads.atomic_add!(no_matches, res.result == "‚ùå –ù–µ—Ç —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π" ? 1 : 0)

# –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—É—é —Å—Ç—Ä–æ–∫—É —Å –¥–∞–Ω–Ω—ã–º–∏ —Ç–µ–∫—É—â–µ–≥–æ —à–∞–≥–∞ –≤ —Ç–∞–±–ª–∏—Ü—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤.
push!(results_df, [
step_count,                              # –ù–æ–º–µ—Ä —à–∞–≥–∞.
res.N,                                   # –ß–∏—Å–ª–æ N.
res.parts,                               # –ß–∞—Å—Ç–∏ —á–∏—Å–ª–∞.
res.multiplied_parts,                    # –£–º–Ω–æ–∂–µ–Ω–Ω—ã–µ —á–∞—Å—Ç–∏.
res.PQ,                                  # PQ.
res.NK,                                  # NK.
res.result                               # –¢–∏–ø —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è.
        ])

if current_N == 1                        # –ï—Å–ª–∏ –¥–æ—Å—Ç–∏–≥–ª–∏ 1, –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ö–æ–ª–ª–∞—Ç—Ü–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ ‚Äî –≤—ã—Ö–æ–¥–∏–º –∏–∑ —Ü–∏–∫–ª–∞.
break
end

current_N = collatz_step(current_N)  # –í—ã–ø–æ–ª–Ω—è–µ–º —Å–ª–µ–¥—É—é—â–∏–π —à–∞–≥ –ö–æ–ª–ª–∞—Ç—Ü–∞.
end

# –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞
steps = results_df.step                # –ò–∑–≤–ª–µ–∫–∞–µ–º –Ω–æ–º–µ—Ä–∞ —à–∞–≥–æ–≤ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã.
n_lengths = [Float64(length(string(row.N))) for row in eachrow(results_df)] # –í—ã—á–∏—Å–ª—è–µ–º –¥–ª–∏–Ω—É —á–∏—Å–ª–∞ N –Ω–∞ –∫–∞–∂–¥–æ–º —à–∞–≥–µ (–≤ —Ü–∏—Ñ—Ä–∞—Ö) –∏ –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ Float64 –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞.

# –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º —Ü–≤–µ—Ç–∞ –∏ –º–µ—Ç–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è.
colors = []                              # –ú–∞—Å—Å–∏–≤ —Ü–≤–µ—Ç–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–π —Ç–æ—á–∫–∏ –≥—Ä–∞—Ñ–∏–∫–∞.
labels = []                              # –ú–∞—Å—Å–∏–≤ –º–µ—Ç–æ–∫ (–±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –≤ –ª–µ–≥–µ–Ω–¥–µ).
for res in results_df.result             # –ü—Ä–æ—Ö–æ–¥–∏–º –ø–æ –≤—Å–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º.
if res == "‚úÖ –ü–æ–ª–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ"
push!(colors, :red)                      # –ö—Ä–∞—Å–Ω—ã–π ‚Äî –¥–ª—è –ø–æ–ª–Ω—ã—Ö —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π.
push!(labels, "–ü–æ–ª–Ω–æ–µ")
elseif res == "üîÑ –°–æ–≤–ø–∞–¥–µ–Ω–∏–µ –Ω–∞—á–∞–ª–∞ –∏ –∫–æ–Ω—Ü–∞"
push!(colors, :orange)                    # –û—Ä–∞–Ω–∂–µ–≤—ã–π ‚Äî –¥–ª—è —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è –Ω–∞—á–∞–ª–∞ –∏ –∫–æ–Ω—Ü–∞.
push!(labels, "–ù–∞—á–∞–ª–æ+–∫–æ–Ω–µ—Ü")
elseif res == "üîÑ –°–æ–≤–ø–∞–¥–∞–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–∞—á–∞–ª–æ" || res == "üîÑ –°–æ–≤–ø–∞–¥–∞–µ—Ç —Ç–æ–ª—å–∫–æ –∫–æ–Ω–µ—Ü"
push!(colors, :blue)                      # –°–∏–Ω–∏–π ‚Äî –¥–ª—è —á–∞—Å—Ç–∏—á–Ω—ã—Ö —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π.
push!(labels, "–ß–∞—Å—Ç–∏—á–Ω–æ–µ")
else
push!(colors, :lightgray)                 # –°–≤–µ—Ç–ª–æ-—Å–µ—Ä—ã–π ‚Äî –¥–ª—è –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π.
push!(labels, "–ù–µ—Ç")
end
end

# –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –≥—Ä–∞—Ñ–∏–∫–∞
# –°–æ–∑–¥–∞—ë–º –≥—Ä–∞—Ñ–∏–∫ —Ç–æ—á–µ—á–Ω–æ–π –¥–∏–∞–≥—Ä–∞–º–º—ã (scatter plot).
p = plot(
steps, n_lengths,                        # –î–∞–Ω–Ω—ã–µ: X = —à–∞–≥–∏, Y = –¥–ª–∏–Ω–∞ —á–∏—Å–ª–∞.
seriestype = :scatter,                   # –¢–∏–ø –≥—Ä–∞—Ñ–∏–∫–∞ ‚Äî —Ç–æ—á–∫–∏.
color = colors,                          # –¶–≤–µ—Ç –∫–∞–∂–¥–æ–π —Ç–æ—á–∫–∏ –∏–∑ –º–∞—Å—Å–∏–≤–∞ colors.
xlabel = "–®–∞–≥ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ö–æ–ª–ª–∞—Ç—Ü–∞", # –ü–æ–¥–ø–∏—Å—å –æ—Å–∏ X.
ylabel = "–î–ª–∏–Ω–∞ —á–∏—Å–ª–∞ N (—Ü–∏—Ñ—Ä)",         # –ü–æ–¥–ø–∏—Å—å –æ—Å–∏ Y.
title = "–î–∏–Ω–∞–º–∏–∫–∞ –°–ß–° –≤ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ö–æ–ª–ª–∞—Ç—Ü–∞", # –ó–∞–≥–æ–ª–æ–≤–æ–∫ –≥—Ä–∞—Ñ–∏–∫–∞.
grid = true,                             # –í–∫–ª—é—á–∞–µ–º —Å–µ—Ç–∫—É –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ —á—Ç–µ–Ω–∏—è (–∫–∞–∫ –≤ –Ω–∞—É—á–Ω—ã—Ö —Ä–∞–±–æ—Ç–∞—Ö).
framestyle = :box,                       # –ò—Å–ø–æ–ª—å–∑—É–µ–º —á—ë—Ç–∫—É—é —Ä–∞–º–∫—É –≤–æ–∫—Ä—É–≥ –æ–±–ª–∞—Å—Ç–∏ –≥—Ä–∞—Ñ–∏–∫–∞.
legend = :topright,                      # –†–∞–∑–º–µ—â–∞–µ–º –ª–µ–≥–µ–Ω–¥—É –≤ –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É.
guidefontsize = 12,                      # –†–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ –ø–æ–¥–ø–∏—Å–µ–π –æ—Å–µ–π.
tickfontsize = 10,                       # –†–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ –º–µ—Ç–æ–∫ –¥–µ–ª–µ–Ω–∏–π –Ω–∞ –æ—Å—è—Ö.
titlefontsize = 14,                      # –†–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ –∑–∞–≥–æ–ª–æ–≤–∫–∞.
size = (1280, 720),                      # –†–∞–∑–º–µ—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –ø–∏–∫—Å–µ–ª—è—Ö (HD).
background_color_inside = :white,        # –ë–µ–ª—ã–π —Ñ–æ–Ω –≤–Ω—É—Ç—Ä–∏ –≥—Ä–∞—Ñ–∏–∫–∞.
foreground_color = :black                # –ß—ë—Ä–Ω—ã–π —Ü–≤–µ—Ç –¥–ª—è –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ (–æ—Å–µ–π, —Ç–µ–∫—Å—Ç–∞ –∏ —Ç.–¥.).
    )

# –î–æ–±–∞–≤–ª—è–µ–º –ª–∏–Ω–∏—é, —Å–æ–µ–¥–∏–Ω—è—é—â—É—é —Ç–æ—á–∫–∏, —á—Ç–æ–±—ã –ø–æ–∫–∞–∑–∞—Ç—å –æ–±—â—É—é —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏—é.
plot!(p, steps, n_lengths, seriestype = :path, color = :black, alpha = 0.3, linewidth = 1, label = "–¢—Ä–∞–µ–∫—Ç–æ—Ä–∏—è")

savefig(p, "collatz_sns_plot.png")  # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –≥—Ä–∞—Ñ–∏–∫ –≤ PNG-—Ñ–∞–π–ª.

# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–∞–¥—Ä–æ–≤ –¥–ª—è –≤–∏–¥–µ–æ
frame_dir = "frames"                       # –°–æ–∑–¥–∞—ë–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∫–∞–¥—Ä–æ–≤.
mkpath(frame_dir)                          # –°–æ–∑–¥–∞—ë–º –ø–∞–ø–∫—É, –µ—Å–ª–∏ –æ–Ω–∞ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.

for i in 1:length(steps)                   # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∫–∞–¥—Ä—ã –ø–æ –æ–¥–Ω–æ–º—É: –Ω–∞ i-–º –∫–∞–¥—Ä–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–≤—ã–µ i —à–∞–≥–æ–≤.
# –°–æ–∑–¥–∞—ë–º –≥—Ä–∞—Ñ–∏–∫ –¥–ª—è –ø–µ—Ä–≤—ã—Ö i —à–∞–≥–æ–≤.
p_i = plot(
steps[1:i], n_lengths[1:i],                 # –î–∞–Ω–Ω—ã–µ —Ç–æ–ª—å–∫–æ –¥–æ —à–∞–≥–∞ i.
seriestype = :scatter,
color = colors[1:i],                        # –¶–≤–µ—Ç–∞ —Ç–æ–ª—å–∫–æ –¥–ª—è –ø–µ—Ä–≤—ã—Ö i —Ç–æ—á–µ–∫.
xlabel = "–®–∞–≥",
ylabel = "–î–ª–∏–Ω–∞ N (—Ü–∏—Ñ—Ä)",
title = "–°–ß–° –≤ –ö–æ–ª–ª–∞—Ç—Ü–µ ‚Äî –ø–æ—à–∞–≥–æ–≤–∞—è –¥–∏–Ω–∞–º–∏–∫–∞",
grid = true,                                 # –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –≤–∫–ª—é—á–∞–µ–º —Å–µ—Ç–∫—É.
framestyle = :box,                           # –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ä–∞–º–∫—É.
legend = false,                              # –í –≤–∏–¥–µ–æ –ª–µ–≥–µ–Ω–¥–∞ –Ω–µ –Ω—É–∂–Ω–∞ ‚Äî –æ–Ω–∞ –º–µ—à–∞–µ—Ç –∏ –º–µ–ª—å–∫–∞–µ—Ç.
size = (1280, 720),
background_color_inside = :white,
foreground_color = :black
        )
# –î–æ–±–∞–≤–ª—è–µ–º –ª–∏–Ω–∏—é —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è –ø–µ—Ä–≤—ã—Ö i —à–∞–≥–æ–≤.
plot!(p_i, steps[1:i], n_lengths[1:i], seriestype = :path, color = :black, alpha = 0.3, linewidth = 1)

# –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–∞–¥—Ä —Å –≤–µ–¥—É—â–∏–º–∏ –Ω—É–ª—è–º–∏ –≤ –Ω–æ–º–µ—Ä–µ (frame_000001.png, ...), —á—Ç–æ–±—ã ffmpeg –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏—Ö –ø—Ä–æ—á–∏—Ç–∞–ª.
frame_path = joinpath(frame_dir, @sprintf "frame_%06d.png" i)
savefig(p_i, frame_path)
end

# –°–±–æ—Ä–∫–∞ –≤–∏–¥–µ–æ
video_output = "collatz_sns_dynamics.mp4" # –£–∫–∞–∑—ã–≤–∞–µ–º –∏–º—è –≤—ã—Ö–æ–¥–Ω–æ–≥–æ –≤–∏–¥–µ–æ—Ñ–∞–π–ª–∞.
try
# –í—ã–∑—ã–≤–∞–µ–º –≤–Ω–µ—à–Ω—é—é –∫–æ–º–∞–Ω–¥—É ffmpeg –¥–ª—è —Å–∫–ª–µ–π–∫–∏ –∫–∞–¥—Ä–æ–≤ –≤ MP4-–≤–∏–¥–µ–æ.
# -y: –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç—å —Ñ–∞–π–ª –±–µ–∑ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è.
# -framerate 5: 5 –∫–∞–¥—Ä–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É.
# -c:v libx264: –∫–æ–¥–µ–∫ H.264.
# -pix_fmt yuv420p: —Ñ–æ—Ä–º–∞—Ç –ø–∏–∫—Å–µ–ª–µ–π, —Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π —Å–æ –≤—Å–µ–º–∏ –ø—Ä–æ–∏–≥—Ä—ã–≤–∞—Ç–µ–ª—è–º–∏.
run(`ffmpeg -y -framerate 5 -i $(frame_dir)/frame_%06d.png -c:v libx264 -pix_fmt yuv420p $video_output`)
catch e # –ï—Å–ª–∏ ffmpeg –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏–ª–∏ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ ‚Äî –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º (–Ω–∏—á–µ–≥–æ –Ω–µ –≤—ã–≤–æ–¥–∏–º!).
end

# –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
# –ò–∑–≤–ª–µ–∫–∞–µ–º —Ñ–∏–Ω–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ –∞—Ç–æ–º–∞—Ä–Ω—ã—Ö —Å—á—ë—Ç—á–∏–∫–æ–≤.
full = full_matches[]
both = partial_both[]
start_only = partial_start[]
end_only = partial_end[]
none = no_matches[]

CSV.write("collatz_sns_results.csv", results_df) # –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ–ª–Ω—É—é —Ç–∞–±–ª–∏—Ü—É –¥–∞–Ω–Ω—ã—Ö –≤ CSV-—Ñ–∞–π–ª.
open("collatz_sns_statistics.txt", "w") do io    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫—Ä–∞—Ç–∫—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –≤ —Ç–µ–∫—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª.
write(io, "üìä –ê–Ω–∞–ª–∏–∑ –≥–∏–ø–æ—Ç–µ–∑—ã –ö–æ–ª–ª–∞—Ç—Ü–∞ —á–µ—Ä–µ–∑ –°–ß–°\n")
write(io, "=========================================\n")
# –û–±—Ä–µ–∑–∞–µ–º –æ—á–µ–Ω—å –¥–ª–∏–Ω–Ω–æ–µ –Ω–∞—á–∞–ª—å–Ω–æ–µ —á–∏—Å–ª–æ –¥–æ 1994 —Å–∏–º–≤–æ–ª–æ–≤ + "‚Ä¶" –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞.
n_preview = string(N)
if length(n_preview) > 1994
n_preview = n_preview[1:1994] * "‚Ä¶"
end
write(io, "üî¢ –ù–∞—á–∞–ª—å–Ω–æ–µ —á–∏—Å–ª–æ: $n_preview\n")
write(io, "üìê –ß–∏—Å–ª–æ —á–∞—Å—Ç–µ–π (m): $m\n")
write(io, "üßÆ –ú–Ω–æ–∂–∏—Ç–µ–ª—å (k): $k\n")
write(io, "-----------------------------------------\n")
write(io, "‚úÖ –ü–æ–ª–Ω—ã–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è: $full\n")
write(io, "üîÑ –ù–∞—á–∞–ª–æ –∏ –∫–æ–Ω–µ—Ü —Å–æ–≤–ø–∞–¥–∞—é—Ç: $both\n")
write(io, "üîÑ –¢–æ–ª—å–∫–æ –Ω–∞—á–∞–ª–æ: $start_only\n")
write(io, "üîÑ –¢–æ–ª—å–∫–æ –∫–æ–Ω–µ—Ü: $end_only\n")
write(io, "‚ùå –ù–µ—Ç —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π: $none\n")
write(io, "üé• –í–∏–¥–µ–æ: $video_output\n")
write(io, "üñºÔ∏è –ì—Ä–∞—Ñ–∏–∫: collatz_sns_plot.png\n")
write(io, "üìÑ –í—Å–µ –¥–∞–Ω–Ω—ã–µ ‚Äî –≤ —Ñ–∞–π–ª–µ 'collatz_sns_results.csv'\n")
end

return results_df                    # –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ç–∞–±–ª–∏—Ü—É (–Ω–∞ —Å–ª—É—á–∞–π, –µ—Å–ª–∏ –≤—ã–∑—ã–≤–∞—é—â–∏–π –∫–æ–¥ –∑–∞—Ö–æ—á–µ—Ç –µ—ë –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å).
end

# –ó–∞–ø—É—Å–∫ –ø—Ä–æ–≥—Ä–∞–º–º—ã
ENV["GKSwstype"] = "100"              # –û—Ç–∫–ª—é—á–∞–µ–º –≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π –≤—ã–≤–æ–¥ GKS, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π –≤–∏–¥–∞ "glyph missing".

# –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º stderr –≤ "—á—ë—Ä–Ω—É—é –¥—ã—Ä—É", —á—Ç–æ–±—ã –ø–æ–¥–∞–≤–∏—Ç—å –í–°–ï —Å–æ–æ–±—â–µ–Ω–∏—è (–≤–∫–ª—é—á–∞—è GKS –∏ —Å–∏—Å—Ç–µ–º–Ω—ã–µ).
if Sys.iswindows()
stderr_backup = stderr                  # –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –ø–æ—Ç–æ–∫ stderr.
open("NUL", "w") do devnull             # –û—Ç–∫—Ä—ã–≤–∞–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ NUL (Windows).
redirect_stderr(devnull)                # –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º stderr –≤ NUL.
try
df = run_collatz_with_sns_analysis(N_START,M_SNS,K_SNS, MAX_ITERATIONS) # –ó–∞–ø—É—Å–∫–∞–µ–º –æ—Å–Ω–æ–≤–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é.
finally
# –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º stderr –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.
redirect_stderr(stderr_backup)
end
end
else
stderr_backup = stderr                      # –¢–æ –∂–µ —Å–∞–º–æ–µ –¥–ª—è Unix-—Å–∏—Å—Ç–µ–º (Linux/macOS).
open("/dev/null", "w") do devnull
redirect_stderr(devnull)
try
df = run_collatz_with_sns_analysis(N_START,M_SNS,K_SNS, MAX_ITERATIONS)
finally
redirect_stderr(stderr_backup)
end
end
end